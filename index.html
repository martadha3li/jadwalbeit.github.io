<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØª</title>
<style>
body{font-family:Tahomaa;background:#f2f4f8;padding:20px}
h1{text-align:center;color:#1e88e5}
.card{background:white;padding:15px;border-radius:10px;margin-bottom:20px;box-shadow:0 4px 10px rgba(0,0,0,0.1)}
button{padding:6px 12px;border:none;border-radius:6px;background:#1e88e5;color:white;cursor:pointer}
button:hover{background:#1565c0}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#e3f2fd}
input,select{width:100%;padding:6px;margin:4px 0}
.admin{display:none;background:#fff3cd;padding:15px;border-radius:8px}
</style>
</head>
<body>

<h1>ğŸ“… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØª</h1>

<div class="card">
<button onclick="chooseWeek(1)">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„</button>
<button onclick="chooseWeek(2)">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ</button>
<button onclick="adminLogin()">ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
</div>

<div class="card">
<h3>ğŸ“‹ Ø§Ù„Ø¬Ø¯ÙˆÙ„</h3>
<div id="schedule"></div>
</div>

<div class="admin" id="adminPanel">
<h3>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>

<label>Ø¥Ø¶Ø§ÙØ© Ø´Ø®Øµ</label>
<input id="newName">
<button onclick="addPerson()">â• Ø¥Ø¶Ø§ÙØ©</button>

<label>Ø­Ø°Ù Ø´Ø®Øµ</label>
<select id="deleteSelect"></select>
<button onclick="deletePerson()">âŒ Ø­Ø°Ù</button>

<label>Ø£ÙŠØ§Ù… Ø§Ù„ØªÙˆØ§Ø¬Ø¯</label>
<select id="daySelect">
<option>Ø§Ù„Ø£Ø­Ø¯</option>
<option>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option>
<option>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
<option>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
</select>
<select id="personSelect"></select>
<button onclick="setAvailability()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø£ÙŠØ§Ù…</button>

<label>ØºÙŠØ§Ø¨ Ø´Ù‡Ø± Ù‡Ø¬Ø±ÙŠ</label>
<select id="monthSelect">
<option>Ù…Ø­Ø±Ù…</option><option>ØµÙØ±</option><option>Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„</option>
<option>Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø¢Ø®Ø±</option><option>Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø£ÙˆÙ„Ù‰</option>
<option>Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø¢Ø®Ø±Ø©</option><option>Ø±Ø¬Ø¨</option>
<option>Ø´Ø¹Ø¨Ø§Ù†</option><option>Ø±Ù…Ø¶Ø§Ù†</option>
<option>Ø´ÙˆØ§Ù„</option><option>Ø°Ùˆ Ø§Ù„Ù‚Ø¹Ø¯Ø©</option>
<option>Ø°Ùˆ Ø§Ù„Ø­Ø¬Ø©</option>
</select>
<button onclick="setMonthAbsence()">ğŸš« ØªÙØ¹ÙŠÙ„ ØºÙŠØ§Ø¨ Ø§Ù„Ø´Ù‡Ø±</button>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, setDoc, deleteDoc, onSnapshot } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBqBXmf2ui2_39MzoK5HLD6nRWYGO28oso",
  authDomain: "jadwal-beit.firebaseapp.com",
  projectId: "jadwal-beit",
  storageBucket: "jadwal-beit.firebasestorage.app",
  messagingSenderId: "324621350402",
  appId: "1:324621350402:web:a17291d57d14a363f9d91b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentWeek=1;
let rotationIndex=0;

function chooseWeek(w){currentWeek=w}

window.adminLogin=function(){
let p=prompt("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ");
if(p==="112233"){
document.getElementById("adminPanel").style.display="block";
}
}

window.addPerson=async function(){
let name=document.getElementById("newName").value.trim();
if(!name)return;
await setDoc(doc(db,"persons",name),{
days:["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡"],
absentMonths:[]
});
document.getElementById("newName").value="";
}

window.deletePerson=async function(){
let name=document.getElementById("deleteSelect").value;
await deleteDoc(doc(db,"persons",name));
}

window.setAvailability=async function(){
let name=document.getElementById("personSelect").value;
let day=document.getElementById("daySelect").value;
await setDoc(doc(db,"persons",name),{
days:[day]
},{merge:true});
}

window.setMonthAbsence=async function(){
let name=document.getElementById("personSelect").value;
let month=document.getElementById("monthSelect").value;
await setDoc(doc(db,"persons",name),{
absentMonths:[month]
},{merge:true});
}

onSnapshot(collection(db,"persons"),(snapshot)=>{
let persons=[];
snapshot.forEach(doc=>persons.push({id:doc.id,...doc.data()}));
generateSchedule(persons);
updateSelects(persons);
});

function updateSelects(persons){
let del=document.getElementById("deleteSelect");
let sel=document.getElementById("personSelect");
del.innerHTML=""; sel.innerHTML="";
persons.forEach(p=>{
del.innerHTML+=`<option>${p.id}</option>`;
sel.innerHTML+=`<option>${p.id}</option>`;
});
}

function generateSchedule(persons){
let days=["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡"];
let html="<table><tr><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th></tr>";

days.forEach(day=>{
let available=persons.filter(p=>p.days.includes(day));
if(available.length===0){
html+=`<tr><td>${day}</td><td>â€”</td></tr>`;
}else{
let person=available[rotationIndex%available.length];
html+=`<tr><td>${day}</td><td>${person.id}</td></tr>`;
rotationIndex++;
}
});
html+="</table>";
document.getElementById("schedule").innerHTML=html;
}

</script>
</body>
</html>
